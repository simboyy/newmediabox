{"version":3,"sources":["auth/google/passport.js"],"names":["setup","User","config","use","clientID","google","clientSecret","callbackURL","accessToken","refreshToken","profile","done","findOne","id","exec","then","user","name","displayName","email","emails","value","role","username","split","provider","_json","save","catch","err"],"mappings":";;;;;QAGgBA,K,GAAAA,K;;AAHhB;;;;AACA;;;;AAEO,SAASA,KAAT,CAAeC,IAAf,EAAqBC,MAArB,EAA6B;AAClC,qBAASC,GAAT,CAAa,kCAAmB;AAC9BC,cAAUF,OAAOG,MAAP,CAAcD,QADM;AAE9BE,kBAAcJ,OAAOG,MAAP,CAAcC,YAFE;AAG9BC,iBAAaL,OAAOG,MAAP,CAAcE;AAHG,GAAnB,EAKb,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,OAApC,EAA6CC,IAA7C,EAAmD;AACjDV,SAAKW,OAAL,CAAa,EAAC,aAAaF,QAAQG,EAAtB,EAAb,EAAwCC,IAAxC,GACGC,IADH,CACQ,gBAAQ;AACZ,UAAIC,IAAJ,EAAU;AACR,eAAOL,KAAK,IAAL,EAAWK,IAAX,CAAP;AACD;;AAEDA,aAAO,IAAIf,IAAJ,CAAS;AACdgB,cAAMP,QAAQQ,WADA;AAEdC,eAAOT,QAAQU,MAAR,CAAe,CAAf,EAAkBC,KAFX;AAGdC,cAAM,MAHQ;AAIdC,kBAAUb,QAAQU,MAAR,CAAe,CAAf,EAAkBC,KAAlB,CAAwBG,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAJI;AAKdC,kBAAU,QALI;AAMdpB,gBAAQK,QAAQgB;AANF,OAAT,CAAP;AAQAV,WAAKW,IAAL,GACGZ,IADH,CACQ;AAAA,eAAQJ,KAAK,IAAL,EAAWK,IAAX,CAAR;AAAA,OADR,EAEGY,KAFH,CAES;AAAA,eAAOjB,KAAKkB,GAAL,CAAP;AAAA,OAFT;AAGD,KAjBH,EAkBGD,KAlBH,CAkBS;AAAA,aAAOjB,KAAKkB,GAAL,CAAP;AAAA,KAlBT;AAmBD,GAzBY,CAAb;AA0BD","file":"passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as GoogleStrategy} from 'passport-google-oauth20';\n\nexport function setup(User, config) {\n  passport.use(new GoogleStrategy({\n    clientID: config.google.clientID,\n    clientSecret: config.google.clientSecret,\n    callbackURL: config.google.callbackURL\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOne({'google.id': profile.id}).exec()\n      .then(user => {\n        if (user) {\n          return done(null, user);\n        }\n\n        user = new User({\n          name: profile.displayName,\n          email: profile.emails[0].value,\n          role: 'user',\n          username: profile.emails[0].value.split('@')[0],\n          provider: 'google',\n          google: profile._json\n        });\n        user.save()\n          .then(user => done(null, user))\n          .catch(err => done(err));\n      })\n      .catch(err => done(err));\n  }));\n}\n"]}